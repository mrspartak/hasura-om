<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Creating fragments | Guide | Hasura ORM</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="Fragment oriented Hasura ORM for backends with many stuff "from the box"">
    <link rel="preload" href="/assets/css/0.styles.d3e2721c.css" as="style"><link rel="preload" href="/assets/js/app.b0b3b14d.js" as="script"><link rel="preload" href="/assets/js/2.8f0b80ee.js" as="script"><link rel="preload" href="/assets/js/3.3e1d89ec.js" as="script"><link rel="preload" href="/assets/js/14.12e1f4cd.js" as="script"><link rel="prefetch" href="/assets/js/10.28e73c70.js"><link rel="prefetch" href="/assets/js/11.e6b53fb8.js"><link rel="prefetch" href="/assets/js/12.c1bfed8a.js"><link rel="prefetch" href="/assets/js/13.667ee254.js"><link rel="prefetch" href="/assets/js/15.c500bb3c.js"><link rel="prefetch" href="/assets/js/16.e41e82c7.js"><link rel="prefetch" href="/assets/js/17.c051b656.js"><link rel="prefetch" href="/assets/js/18.e922d575.js"><link rel="prefetch" href="/assets/js/19.227f4d19.js"><link rel="prefetch" href="/assets/js/4.c5e72030.js"><link rel="prefetch" href="/assets/js/5.f2fb31f5.js"><link rel="prefetch" href="/assets/js/6.6676af00.js"><link rel="prefetch" href="/assets/js/7.87be8f7d.js"><link rel="prefetch" href="/assets/js/8.99882b7b.js"><link rel="prefetch" href="/assets/js/9.fc5e3096.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d3e2721c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/hasura_icon_blue.svg" alt="Hasura ORM" class="logo"> <span class="site-name can-hide">Hasura ORM</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/create-fragment.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/ru/" class="nav-link">
  Русский (черновик)
</a></li></ul></div></div> <a href="https://github.com/mrspartak/hasura-om" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/create-fragment.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/ru/" class="nav-link">
  Русский (черновик)
</a></li></ul></div></div> <a href="https://github.com/mrspartak/hasura-om" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/guide/getting-started.html" class="sidebar-link">Getting started</a></li><li><a href="/guide/create-fragment.html" aria-current="page" class="active sidebar-link">Creating fragment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/create-fragment.html#an-idea" class="sidebar-link">An idea</a></li><li class="sidebar-sub-header"><a href="/guide/create-fragment.html#what-are-fragments" class="sidebar-link">What are fragments?</a></li><li class="sidebar-sub-header"><a href="/guide/create-fragment.html#how-fragments-are-created" class="sidebar-link">How fragments are created</a></li><li class="sidebar-sub-header"><a href="/guide/create-fragment.html#ways-to-define-fields" class="sidebar-link">Ways to define fields</a></li><li class="sidebar-sub-header"><a href="/guide/create-fragment.html#extending-fragment-from-already-defined" class="sidebar-link">Extending fragment from already defined</a></li><li class="sidebar-sub-header"><a href="/guide/create-fragment.html#fragments-with-nested-fields-with-arguments" class="sidebar-link">Fragments with nested fields with arguments</a></li></ul></li><li><a href="/guide/query.html" class="sidebar-link">Making queries</a></li><li><a href="/guide/mutation.html" class="sidebar-link">Making mutations</a></li><li><a href="/guide/subscribe.html" class="sidebar-link">Subscribing</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Api</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/api/" class="sidebar-link">Introduction</a></li><li><a href="/api/hasura.html" class="sidebar-link">Hasura</a></li><li><a href="/api/table.html" class="sidebar-link">Table</a></li><li><a href="/api/field.html" class="sidebar-link">Field</a></li><li><a href="/api/fragment.html" class="sidebar-link">Fragment</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="creating-fragments"><a href="#creating-fragments" class="header-anchor">#</a> Creating fragments</h1> <h2 id="an-idea"><a href="#an-idea" class="header-anchor">#</a> An idea</h2> <p>Hasura offers an easy API to get/manipulate data by table name. It is used in every type, so there is only one variable that is unknown: fields and relations and most of the time I spent my time writing fragments with all needed relations. Most of them were basic, for example get new generated ID on insert or select all data from table.
So the idea was to scaffold all queries, automaticaly generate basic fragments and leave an ability to create any fragment and reuse it.</p> <h2 id="what-are-fragments"><a href="#what-are-fragments" class="header-anchor">#</a> What are fragments?</h2> <p>If you are not familiar with graphql - fragments are just an interface to describe fields and reuse them in request. So the goal was to make requests more readable and reuse some parts, but I think this is a good chance to write all the code just in fragments and do not write anything else.</p> <p>So here is how fragments work. For example we have basic table <code>user</code> (id, name, user_pic_id) and table <code>images</code> (id, url). Relation is <code>user</code>.<code>user_pic_id</code> -&gt; <code>images</code>.<code>id</code> (user_pic)</p> <div class="language- extra-class"><pre class="language-text"><code>query user {
    id
    name
    user_pic {
        url
    }
}
</code></pre></div><p>Of course I could track all first/second level relations and make this fragments too, but I think this is really bad in terms memory consumptions etc. So for now hasura-om creates 2 basic fragments 'base' and 'pk'</p> <div class="language- extra-class"><pre class="language-text"><code>Fragment base_fragment_user on user {
    id
    name
    user_pic_id
}
Fragment pk_fragment_user on user {
    id
}

Fragment base_fragment_images on images {
    id
    url
}
Fragment pk_fragment_images on images {
    id
}
</code></pre></div><h2 id="how-fragments-are-created"><a href="#how-fragments-are-created" class="header-anchor">#</a> How fragments are created</h2> <p>I have class Fragment that takes name, table and fields and generate a fragment that can be used anywhere even without link to a table</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Fragment <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'hasura-om'</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> baseFragment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fragment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    table<span class="token operator">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'base'</span><span class="token punctuation">,</span>
    fields<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        id
        name
        user_pic_id
    </span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>
    raw<span class="token punctuation">,</span>
    arguments
<span class="token punctuation">}</span> <span class="token operator">=</span> baseFragment<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">/* 
    name - base_fragment_user
    raw - Fragment base_fragment_user on user {
        id
        name
        user_pic_id
    }
    argumets - []
*/</span>
</code></pre></div><h2 id="ways-to-define-fields"><a href="#ways-to-define-fields" class="header-anchor">#</a> Ways to define fields</h2> <p>So the main trick here is how you can define fields. So there is (function)[https://github.com/mrspartak/hasura-om/blob/master/src/utils/builders.js] that transofrm whatever you pass to string format of fields.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//string</span>
<span class="token keyword">let</span> fields <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    id
    name
    user_pic {
        url
    }
</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">//array</span>
<span class="token keyword">let</span> fields <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'id'</span><span class="token punctuation">,</span>
    <span class="token string">'name'</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token string">'user_pic'</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token string">'url'</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span>

<span class="token comment">//object</span>
<span class="token keyword">let</span> fields <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'id'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    'name<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'user_pic'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        children<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'url'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//and children can be any format from above</span>
</code></pre></div><h2 id="extending-fragment-from-already-defined"><a href="#extending-fragment-from-already-defined" class="header-anchor">#</a> Extending fragment from already defined</h2> <p>Of course you can reuse already defined fragments</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> baseUserFragment <span class="token operator">=</span> orm<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fragment</span><span class="token punctuation">(</span><span class="token string">'base'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> baseImageFragment <span class="token operator">=</span> orm<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fragment</span><span class="token punctuation">(</span><span class="token string">'base'</span><span class="token punctuation">)</span>

orm<span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createFragment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'with_profile_pic'</span><span class="token punctuation">,</span>
    fields<span class="token operator">:</span> <span class="token punctuation">[</span>
        baseUserFragment<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token string">'user_pic'</span><span class="token punctuation">,</span>
            <span class="token punctuation">[</span>
                baseImageFragment
            <span class="token punctuation">]</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="fragments-with-nested-fields-with-arguments"><a href="#fragments-with-nested-fields-with-arguments" class="header-anchor">#</a> Fragments with nested fields with arguments</h2> <p>There is a way to filter nested fields</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//array</span>
<span class="token keyword">let</span> fields <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'id'</span><span class="token punctuation">,</span>
    <span class="token string">'name'</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
        <span class="token string">'user_pic'</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span>
            <span class="token string">'url'</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            limit<span class="token operator">:</span> <span class="token string">'user_pic_limit'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span>

<span class="token comment">//or object</span>
<span class="token keyword">let</span> fields <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'id'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    'name<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'user_pic'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        children<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token string">'url'</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        filter<span class="token operator">:</span> <span class="token punctuation">{</span>
            limit<span class="token operator">:</span> <span class="token string">'user_pic_limit'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This will crete fragment with arguments by nested field and also will pass arguments to operation. Here you need to provide an unique variable name for your filter and then pass this variable to a request</p> <div class="language- extra-class"><pre class="language-text"><code>Fragment base_fragment_user on user {
    id
    name
    user_pic (limit: $user_pic_limit) {
        url
    }
}
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/getting-started.html" class="prev">
        Getting started
      </a></span> <span class="next"><a href="/guide/query.html">
        Making queries
      </a>
      →
    </span></p></div>  <footer class="footer" data-v-0fa9bcfa>
	This framework is not affiliated with the Hasura team.
	<br data-v-0fa9bcfa><br data-v-0fa9bcfa>
	MIT Licensed | 2020-present
	<a href="https://github.com/mrspartak" target="_blank" rel="noopener noreferrer" data-v-0fa9bcfa>by Spartak</a></footer></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b0b3b14d.js" defer></script><script src="/assets/js/2.8f0b80ee.js" defer></script><script src="/assets/js/3.3e1d89ec.js" defer></script><script src="/assets/js/14.12e1f4cd.js" defer></script>
  </body>
</html>
